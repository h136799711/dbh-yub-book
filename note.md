## 备忘录

理财模块

下单模块

分销佣金模块

### 枚举类型


### 流程

1. 充值流程 (2次接口调用)    
    1.1 获取可用的支付通道 (前端可进行缓存)   
    1.2 创建充值订单，并返回订单id,根据订单ID,创建支付订单,并返回支付链接        
    1.4 前端将页面转发到返回的支付链接, 等待用户进行支付   
    1.4.1 用户支付失败(超时或其它原因), 不进行处理   
    1.4.2 支付成功(则进行余额增加日志记录、充值订单状态变更、支付订单状态变更)
   
2. 下单流程
    从余额里扣
    2.1 创建下单/理财订单， 余额足够 创建成功，然后扣除余额，增加日志 余额不足则创建失败 
    
3. 提现流程
    3.1 创建提现申请，
    3.2 后台进行提现审核，并使用(代付接口\人工转账)进行处理

4. 收益计算
    4.1 当天转入次日计算
    4.2 
### 定时任务

1. 充值订单超时?
2. 每日一次佣金收益统计
3. 每日一次理财收益统计
4. 支付成功订单进行佣金分配
5. 每日一次理财宝派息计算


### 用户权益

|级别|满足条件余额|每日可下订单数|最大收益金额|收益率固定值|收益率百分比|每日提现次数|   
|----|---|---|---|---|---|---|
|普通用户|0|20|0|10|0|0|
|VIP1|6000|26|500|0|0.0030|1|
|VIP2|15000|28|1300|0|0.0032|2|
|VIP3|30000|30|3000|0|0.0034|2|
|VIP4|60000|32|7000|0|0.0036|3|
|VIP5|120000|34|16000|0|0.0038|4|
|VIP6|220000|36|32000|0|0.0040|5| 


### 三级销售

一级: 16%
二级: 10%
三级: 4%

### 资产

1. 每日佣金统计   
   用户id，总收益，团队人数, 所在层级（0：总 1：一级 2：二级 3：三级）
   
2. 佣金明细   
   用户id, 变动金额，来源用户, 变动日志（一级佣金收入、二级佣金收入、三级佣金收入）
   
3. 理财产品   
   产品代号， 收益率, 每多少天计息, 是否可随时取出， 总存款,起存金额, 下期计息时间,本期计息时间，最近一次成功计息
   3.1 如何保证每个持有人都有收益？
   3.2 遍历持有资产表按持有金额大小排序，优先处理金额大的  
   3.3 计算收益增加到理财持有表的持有金额表中,并记录日志写入资产明细表
   3.4 计算时 理财转入买入 
      
4. 理财产品用户持有资产表   
   用户id, 理财产品编号, 已确认持有金额, 收益金额，最近一次计息时间
   
    
5. 理财产品用户资产明细表   
   用户id, 理财产品编号，收益率, 当前金额, 变动金额(正收入负支出), 变动类型（存入利息、支出提现、存入等待、存入成功、），计息期数（年月日）, 处理时间
    

7. 归总钱包帐户   
   用户id 用户总余额 用户总提现金额 用户总理财收益
  
  
### 问题记录

1. 如何成为代理商 - 成为VIP后、充钱后、充钱提现后还能是代理商？
2. 提现银行卡信息怎么填写？国内银行卡？
   暂定国内卡信息
3. 下单是什么？商品？怎么确定
    
5. Team 团队佣金和个人佣金有什么区别?   
6. Team Running 是什么？   
7. 提现是否要审核？   
8. 提现手续费   
9. 充值有没有手续费？充多少就是多少？    没有手续费
10. 收益计算按什么时区算(当地时间?) 1天怎么计算的?    
11. 提现走第三方的代付接口，2块内容：1目标市场国家有哪几个银行； 2根据代付接口做一个批量转帐的后台。

12. 每日最大收益包含哪些收益？余额宝收益？
13. 今天4号转入余额宝 ，如果存1天的话 什么时候算收益，5号结算？还是6号结算？
14. 周末是否算收益？是否可以转出？
15. 用余额购买定期？赎回时回到余额？还是余额宝？ 用余额宝购买同样问题， 
16. 购买定期产品 是否需要让用户选择用余额 还是 余额宝的资金进行购买，现在默认用的余额
17. 自动赎回失败出错时要怎么保证能赎回, 避免多次计算收益
18. 增加派息次数
19. [BUG] 每次转入一个定期要判断和上一次的日期，如果不是同一天就要分成2条记录
